$(document).ready(function () {
    $('header .desktop .msg').mouseenter(function () {
        $this_nav = $(this)
        $this_dropdown = $('header .desktop .msg-links')
        a = $this_nav.offset().left
        b = $this_nav.outerWidth()
        c = $this_dropdown.outerWidth()

        $this_dropdown.fadeIn()

        x = a + ((b - c) / 2)

        $this_dropdown.css('display', 'flex')
        $this_dropdown.offset({left: x})
    })

    $('header .msg').mouseleave(function () {
        a = setTimeout(function () {
            $('.desktop .msg-links').fadeOut()
        }, 500)
        $('header .desktop .msg').one('mouseenter', function () {
            clearTimeout(a)
        })
        $('header .desktop .msg-links').one('mouseenter',function () {
            clearTimeout(a)
            $('header .desktop .msg-links').one('mouseleave', function () {
                $('.desktop .msg-links').fadeOut()
            })
        })
    })




    $('.burger, .mobile .links a').click(function () {
        $('body, .burger, .bg').toggleClass('active')
    })


    $('header .mobile .msg').click(function () {
        $this_nav = $(this).parent()
        $this_dropdown = $('header .mobile .msg-links')
        a = $this_nav.offset().left
        b = $this_nav.outerWidth()
        c = $this_dropdown.outerWidth()

        $this_dropdown.fadeIn()

        x1 = a + ((b - c) / 2)

        $this_dropdown.css('display', 'flex')
        $this_dropdown.offset({left: x1})
    })

    $('header').mouseenter(function () {
        $('.header-wrap').removeClass('hidden')
    })
    oldOffset = 0
    $(document).scroll(function () {
        $('.header-wrap').addClass('hidden')
        if ($('header').offset().top < 84 || oldOffset > $('header').offset().top) {
            $('.header-wrap').removeClass('hidden')
        }

        if ($('header').offset().top < $('.hero').outerHeight()) {
            $('.header-wrap').removeClass('tan')
        } else {
            $('.header-wrap').addClass('tan')
        }
        oldOffset = $('header').offset().top
    })
})

document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();

        document.querySelector(this.getAttribute('href')).scrollIntoView({
            behavior: 'smooth'
        });
    });
});
$(document).ready(function (){
    if ($('.hero').length != 0){
        setTimeout(function (){
            $('.animated').addClass('active')
        }, 300)
    }
})
$(document).ready(function (){
    const swiper2 = new Swiper(".inst-swiper", {
        slidesPerView: 1,
        spaceBetween: 30,

        navigation: {
            nextEl: ".nav-next",
            prevEl: ".nav-prev",
        },
        speed: 400,
        autoplay: {
            delay: 800,
          },

        breakpoints: {
            700: {
                slidesPerView: 3,
                spaceBetween: 30,
                pagination: false
            }
        },
    });
})
$(document).ready(function () {
    const swiper = new Swiper(".card-container", {
        slidesPerView: 1,
        spaceBetween: 20,

        pagination: {
            el: ".pagination",
            clickable: true,
        },
        navigation: {
            nextEl: ".nav-next",
            prevEl: ".nav-prev",
        },
        breakpoints: {
            700: {
                slidesPerView: 2,
                spaceBetween: 20,
            },
            1300: {
                slidesPerView: 3,
                spaceBetween: 40,
                allowTouchMove: false,
            },
            1800: {
                slidesPerView: 4,
                spaceBetween: 30,
            },
        },
    });

    // tex = '<div class="selector-dropdown"></div>'

    // $('.card-selector').click(function (e) {
    //     e.stopPropagation()
    //     $('.selector-dropdown').remove()
    //     $this_btn = $(this)
    //     $('body').append(tex)
    //     $dropdown = $('.selector-dropdown')
    //     $this_options = $this_btn.parent().find('.card-list__option')


    //     $this_options.each(function () {
    //         $dropdown.append('<p>' + $(this).text() + '</p>')
    //     })

    //     $(window).on('click',function() {
    //         $('.selector-dropdown').remove()
    //     });

    //     $('.main-slider .swiper-wrapper').on('touchstart',function() {
    //         $('.selector-dropdown').remove()
    //     });


        // btn_left = $this_btn.offset().left
        // btn_top = $this_btn.offset().top - $dropdown.outerHeight() + $this_btn.outerHeight()
        // b = $this_btn.outerWidth()
        // $dropdown.css('display', 'flex')
        // $dropdown.css('width', b)
        // $dropdown.offset({left: btn_left})
        // $dropdown.offset({top: btn_top})

    // })


})
$(document).ready(function (){
    function parallax(e) {
        let _w = window.innerWidth/2;
        let _h = window.innerHeight/2;
        let _mouseX = e.clientX;
        let _mouseY = e.clientY;
        let _depth1 = `${50 - (_mouseX - _w) * 0.01}% ${50 - (_mouseY - _h) * 0.01}%`;
        let _depth2 = `${50 - (_mouseX - _w) * 0.02}% ${50 - (_mouseY - _h) * 0.02}%`;
        let _depth3 = `${50 - (_mouseX - _w) * 0.06}% ${50 - (_mouseY - _h) * 0.06}%`;
        let x = `${_depth3}, ${_depth2}, ${_depth1}`;
        console.log(x);
        elem.style.backgroundPosition = x;
    }

    $(document).mouse


});
function showInfoMessage(title, message)
  {var values;
   if(arguments.length <= 1)
     {var type = title, DATA_BY_TYPES = {'personal-service': {title: 'Спасибо за классную идею!', message: 'Мы обязательно возьмём её в работу.'}}, DEFAULT_DATA_BY_TYPE = {title: 'Спасибо за Вашу заявку.', message: 'Мы свяжемся с Вами в ближайшее время.'};
      values = (typeof type == 'object') ? type : (((type === undefined) || (!DATA_BY_TYPES.hasOwnProperty(type))) ? DEFAULT_DATA_BY_TYPE : DATA_BY_TYPES[type]); 
     }
   else
     {values = {title: title, message: message};
     }
   if(title === undefined)
     {title = 'Спасибо за Вашу заявку.';
     }
   if(message === undefined)
     {message = 'Мы свяжемся с Вами в ближайшее время.';
     }
   $('.popup1, .popup2').hide();
   $('.popup3 .popup3-info').html('<p>' + values.title + '</p><p>' + values.message + '</p>');
   $('.popup3').show();
   /*
    vex.dialog.alert({
                   message: values.message,
                   callback: function (value) {
                       if (value) {
                           console.log('Готово! Водитель подаст автомобиль в течение 10-15 минут. The Valet Concierge');
                       } else {
                           console.log('Chicken.')
                       }
                   }
               });
   */
  }
var PRICES = {"valet-parking": 'от 6500₽ в день',
'городской паркинг': '1000₽ тариф дневной (8:00-19:00)<br><br>2000₽ тариф суточный',
'заправить': 'от 2000₽',
'помыть': 'от 3000₽',
'доставить авто': 'от 5000₽',
'ответственное хранение авто': '2000₽ / сутки',
'личный помощник': 'от 1000₽',
'шиномонтаж и хранение': 'от 6500₽',
'детейлинг': 'от 6000₽',
'техническое обслуживание и ремонт': 'от 25000₽',
'эвакуация + трансфер': 'от 8000₽',
'купить новый автомобиль': '',
'подбор автомобиля с пробегом': '',
'запчасти, шины и аксессуары': '',//'5%',
'регистрация и учет': '15000₽',
'страхование': '0₽',//'от 2500₽',
'кредитование': 'от 2%',
'автоломбард': 'от 3%',
'продать автомобиль': '',
'выкуп': '90% от рыночной стоимости',
'техническое обслуживание': 'от 2500₽ / 30 минут',
'лизинг': 'от 0% удорожание'}, FEEDBACKS = {'заправить': {'image': SITE_TEMPLATE_PATH + '/image/feedback/p_zolotuhin.jpg', 'text': 'Очень удобное решение! Пока был на встрече, мне заправили и помыли машину. Огромное спасибо за правильный сервис!', 'author': 'Валерий Золотухин, Maserati Levante, @zolotukhin_impact'},
'помыть': {'image': SITE_TEMPLATE_PATH + '/image/feedback/ablyazin.png', 'text': 'Забрали машину, помыли и через полтора часа вернули чистую обратно. Пользуюсь теперь постоянно. Особенно удобно, когда возвращаешься домой. На утро машина всегда чистая!', 'author': 'Денис Аблязин, Lexus LX, @denis_abliazin'},
'доставить авто': {'image': SITE_TEMPLATE_PATH + '/image/feedback/alexandrov.png', 'text': 'Водитель доставил нашу машину в Сочи вместе с багажом. Мы летели налегке. Спасибо за новый опыт!', 'author': 'Вадим Александров, Mercedes Benz V, @mindsurfa'},
'ответственное хранение авто': {'image': SITE_TEMPLATE_PATH + '/image/feedback/drozdov.png', 'text': 'Спасибо за передержку! Особенно порадовали 2000₽ за целые сутки в крытом паркинге против 380₽ в час в Центре. В следующий раз обязательно закажу подачу машины в аэропорт. Не знал, что так можно. Вы сделали очень полезный сервис. Молодцы!', 'author': 'Александр Дроздов, Toyota Rav4, @alexandr_training_life'},
'личный помощник': {'image': SITE_TEMPLATE_PATH + '/image/feedback/vetkovskaya.png', 'text': 'Забрали детей по нескольким адресам и отвезли на мероприятие, а затем развезли по домам. И так всю неделю. Спасибо сервису за помощь!', 'author': 'Анастасия Ветковская, Land Rover Discovery, @vetkovskaya.nastya'},
'шиномонтаж и хранение': {'image': SITE_TEMPLATE_PATH + '/image/feedback/zhivora.png', 'text': 'Водитель не только сделал шиномонтаж в день моего обращения, но и привез зимние шины из Чехова. Летние забрал на сезонное хранение. Сервис рекомендую', 'author': 'Надежда Живора, BMW X3, @nadezhdazhivora'},
'детейлинг': {'image': SITE_TEMPLATE_PATH + '/image/feedback/alexei_drozdov.png', 'text': 'Покрыл машину керамикой пока был в отпуске. Сами забрали, все сделали и вернули. Безупречный сервис!', 'author': 'Алексей Дроздов, Porsche Boxter, @alesha_drozdovv'},
'техническое обслуживание и ремонт': {'image': SITE_TEMPLATE_PATH + '/image/feedback/makarov.png', 'text': 'Машину передал водителю прямо у входа в аэропорт. Её забрали на ТО и организовали хранение. По прилету вернули чистую, заправленную и обслуженную. Обращаюсь повторно. Всё всегда на высоте!', 'author': 'Евгений Макаров, Land Rover Velar, @garuda44'},
'эвакуация + трансфер': {'image': SITE_TEMPLATE_PATH + '/image/feedback/mkrtchan.png', 'text': 'Профессиональная команда. Забрали ключи, вернули ключи. Минимальная коммуникация', 'author': 'Нил Мкртчян, Range Rover Sport, @nil.mkrtchyan'},
'купить новый автомобиль': {'image': SITE_TEMPLATE_PATH + '/image/feedback/primakov.png', 'text': 'Менеджер оперативно подобрал мне подходящую машину из наличия, помог определиться с комплектацией и опциями, а также сам согласовал для меня выгодные условия', 'author': 'Павел Примаков, BMW X7, @ppg001'},
'подбор автомобиля с пробегом': {'image': SITE_TEMPLATE_PATH + '/image/feedback/ketraru.png', 'text': 'Заказала в сентябре услугу индивидуальный подбор. Машину мне нашли, проверили, согласовали условия и доставили из Санкт-Петербурга в Тольятти прямо к дому. Подали чистую, обслуженную и заправленную. Категорически рекомендую!', 'author': 'Светлана Кетрару, Mercedes Benz GLE Coupe, @svetlakontra'},
'продать автомобиль': {'image': SITE_TEMPLATE_PATH + '/image/feedback/mihailova.png', 'text': 'Если мне нужно продать машину, я обращаюсь только сюда. Сразу точно оценивают, никаких подводных камней. Все проверки на месте, никуда ехать не надо. Деньги сразу поступают на карту. Желаю сервису успехов и побольше клиентов!', 'author': 'Анна Михайлова, Mercedes Benz C200 Coupe,@any.impact'},
'запчасти, шины и аксессуары': {'image': SITE_TEMPLATE_PATH + '/image/feedback/korshunov1.png', 'text': 'Оставил заявку на покупку редкой резины перед командировкой. Когда вернулся она уже ждала меня на удобной мне локации. Шиномонтаж тоже организовали. Спасибо за внимательное отношение', 'author': 'Валентин Коршунов, Jaguar F-pace, @valentin.korshunov'},
'регистрация и учет': {'image': SITE_TEMPLATE_PATH + '/image/feedback/poryadin.png', 'text': 'Обращался за помощью в регистрации новой машины, купленной на юр.лицо. Утром забрали из офиса, после обеда вернули зарегистрированную. Также пользуюсь детейлингом и страхованием. Всё организовано безупречно. Водители вежливые, цены вполне адекватные. Обязательно вернусь. Большое спасибо!', 'author': 'Порядин Алексей, BMW 5, @alexey.poriadin'},
'страхование': {'image': SITE_TEMPLATE_PATH + '/image/feedback/saakova.png', 'text': 'Практически с первых слов общения подкупает внимательность и вежливость менеджера. Он подобрал для меня оптимальный полис в надежной компании, прислал ссылку на оплату, а затем и сам полис на электронную почту. Спасибо за внимательное отношение к клиенту', 'author': 'Ирина Саакова, Mercedes Benz CLS, @saakova_i'}}, DESCRIPTIONS = {'городской паркинг': 'Ключи от машины отдаете парковщику, он отгоняет ее на охраняемую стоянку. По Вашему требованию  автомобиль подадут. Услуга пользуется большим спросом в Москве.', 'кредитование': 'Персональный подбор автокредита при профессиональной поддержке The Valet. Отправьте заявку и получите одобрение от ведущих банков.', 'valet-parking': 'Наличие бесплатной парковки для любого заведения — весомый бонус. Ведь поиск места для машины может серьезно испортить вечер гостям. Ключи от машины можно отдать парковщику у входа, и он отгонит ее на охраняемую стоянку. После ужина авто подадут ко входу. Услуга пользуется большим спросом в ряде московских заведений. Теперь это доступно для аутсорсинга.', 'техническое обслуживание': 'Только для наиболее требовательных корпоративных клиентов The Valet предлагает  организацию долгосрочного обслуживания автопарков в дилерских центрах.', 'лизинг': 'The Valet подберет подходящую под Ваши цели программу у лидеров лизингового рынка России.', 'автоломбард': 'Если Вам нужна компетентная помощь в оперативном получении займа на справедливых условиях, обращайтесь. The Valet всегда на Вашей стороне.'};
$(document).ready(function () {
   for(var key in FEEDBACKS)
     {
         if(FEEDBACKS.hasOwnProperty(key))
        {var img = new Image();
         img.src = FEEDBACKS[key].image;         
        //  debugger;         
        }        
     }
    $('.card-list__option').click(function () {
        // $this_btn = $(this)
        // $card = $this_btn.parent()
        // $checked = $card.find('input:checked')
        // if($checked.length == 0){
        //     return
        // }
        // option = $checked.next().text()
        option = $(this).html()
        $('#popup-1 [for-data="title"]').html(option);
        var processedOption = option.trim().toLowerCase();
        if(FEEDBACKS.hasOwnProperty(processedOption))
          {var feedbackData = FEEDBACKS[processedOption];
           $('#popup-1 [for-data="feedback-author-photo"]').show().attr('src', feedbackData.image);
           $('#popup-1 [for-data="feedback-text"]').html(['«', feedbackData.text, '»'].join(''));
           $('#popup-1 [for-data="feedback-author"]').show().html(feedbackData.author.replace(/@([a-z_\d\-.]+)/i, '<a href = "https://www.instagram.com/$1/" target = "_blank">$&</a>'));
          }
        else
          {$('#popup-1 [for-data="feedback-author-photo"]').hide();
           $('#popup-1 [for-data="feedback-text"]').html(DESCRIPTIONS.hasOwnProperty(processedOption) ? DESCRIPTIONS[processedOption] : 'Отзыв отсутствует');
           $('#popup-1 [for-data="feedback-author"]').hide();
          }
        $('#popup-1 [for-data="price"]').html(PRICES.hasOwnProperty(processedOption) ? PRICES[processedOption] : '<SPAN title = "Цена не указана">-</SPAN>');
        $('body').css('overflow', 'hidden');
        $('#popup-1').fadeIn();
    });
    $('.close').click(function () {
        $('body').css('overflow', 'auto')
        $('.popup').fadeOut()
        $('#error').remove()
    })
    $('.popup-overlay').click(function () {
        $('body').css('overflow', 'auto')
        $('.popup').fadeOut()
        $('#error').remove()
    })
    $('.card-list__option1').click(function() { 
        var popup_id = $('#' + $(this).attr("rel"));
        $(popup_id).fadeIn();
        $('.popup2').fadeIn();
        $('body').css('overflow', 'hidden')
    })

    $('.popup button').click(function (event) {
        var $popup = $(event.currentTarget).parents('.popup').eq(0), onSuccess = function (data){
                    if (data === 'correct') {
                        $('.popup .accept-wrap').after('<p id="error" style="color: #8F2426">Данные введены не корректно</p>');
                    } else {
                        arguments.callee.$popup.find('> .wrap > .layout > .close').trigger('click');
                        showInfoMessage();
                        //$(".popup3").show();
                        // window.location.replace('success.php') //сюда url страницы успеха
                    }
                }, onError = function()
                  {alert('Что-то пошло не так');                     
                  };
        onSuccess.$popup = $popup;
        onError.$popup = $popup;
        event.preventDefault()
        $('#error').remove()
        if ($('.accept-wrap .checkbox').is(':checked')) {
            $.ajax({
                type: 'POST',
                url: '/sender.php', // сюда адрес api куда шлем
                data: {
                  phone: $('.popup .text-input').val(),
                  service: $('.popup h3').text()
                },
                success: onSuccess,
                error: onError
            })
        }
        else {
            $('.popup .accept-wrap').after('<p id="error" style="color: #8F2426">Примите условия</p>')
        }
    })
    $('.popup2 button').click(function (e) {
        var detailType = e.target.getAttribute('detail-type');
        e.preventDefault();
        $('#error').remove()
            $.ajax({
                type: 'POST',
                url: '/sender.php', // сюда адрес api куда шлем
                data: {
                  offer: $('.popup2 .text-input').val(),
                  service: $('.popup2 #add-offer').val()
                },
                success: function (data){
                    if (data === 'correct') {
                        $('.popup2 .accept-wrap').after('<p id="error" style="color: #8F2426">Данные введены не корректно</p>')
                    } else {
                        showInfoMessage(detailType);
                        // window.location.replace('success.php') //сюда url страницы успеха
                    }
                },
                error: function (){
                    alert('Что-то пошло не так')
                }
            })
    });
    $('input.text-input').on('focus', function(event)
      {event.currentTarget.setSelectionRange(0, 0);
      });
    switch(document.location.pathname)
      {case '/tyres/':
         $('.card-list__option[for="option7"]').trigger('click');
         break;
      }
});

$('.close').click(function() { // Обрабатываем клик по заднему фону
    $('body').css('overflow', 'auto')
    $('.popup2').hide(); // Скрываем затемнённый задний фон и основное всплывающее окно
})
$('.close').click(function() { // Обрабатываем клик по заднему фону
    $('body').css('overflow', 'auto')
    $('.popup3').hide(); // Скрываем затемнённый задний фон и основное всплывающее окно
})

$('.popup-overlay').click(function() { // Обрабатываем клик по заднему фону
    $('body').css('overflow', 'auto')
    $('.popup3').hide(); // Скрываем затемнённый задний фон и основное всплывающее окно
})
$('.popup-overlay').click(function() { // Обрабатываем клик по заднему фону
    $('body').css('overflow', 'auto')
    $('.popup2').hide(); // Скрываем затемнённый задний фон и основное всплывающее окно
})
$('.popup-overlay').click(function() { // Обрабатываем клик по заднему фону
    $('body').css('overflow', 'auto')
    $('.popup2').hide(); // Скрываем затемнённый задний фон и основное всплывающее окно
})
$('.closeok').click(function() { // Обрабатываем клик по заднему фону
    $('body').css('overflow', 'auto')
    $('.popup3').hide(); // Скрываем затемнённый задний фон и основное всплывающее окно
})
$('.popup-overlay').click(function() { // Обрабатываем клик по заднему фону
    $('body').css('overflow', 'auto')
    $('.popup3').hide(); // Скрываем затемнённый задний фон и основное всплывающее окно
});
/*
window.addEventListener('load', function()
  {switch(document.location.pathname)
     {case '/tires/':
        $('.card-list__option[for="option7"]').trigger('click');
        break;
     }
  });
*/